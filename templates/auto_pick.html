{% extends "base.html" %}
{% block title %}מוצרים מנצחים – AICommerce{% endblock %}

{% block content %}
<div class="card">

<h1>🔥 מוצרים מנצחים – בחירה אוטומטית</h1>

<p style="font-size:15px; margin-bottom:15px;">
המערכת סרקה את השוק בזמן אמת ודירגה מוצרים לפי
<b>פוטנציאל רווח עתידי</b>, ביקוש וטרנד.
מוצרים מעל 70% נחשבים <b>להזדמנויות חזקות מאוד.</b>
</p>

<a href="{{ url_for('export_auto_pick_csv') }}">
    ⬇️ הורדת CSV
</a>

<br><br>

<p>📦 כמות מוצרים שמגיעה: {{ results|length }}</p>

<table>
<thead>
<tr>
    <th>דירוג</th>
    <th>תמונה</th>
    <th>שם מוצר</th>
    <th>קטגוריה</th>
    <th>מחיר</th>
    <th>מחיר מכירה</th>
    <th>רווח</th>
    <th>ROI %</th>
    <th>כמות הזמנות</th>
    <th>אחוז הצלחה</th>
    <th>קישור</th>
</tr>
</thead>

<tbody>
{% for p in results %}
<tr>

<td>{{ loop.index }}</td>

<td>
    {% if p.image %}
        <a href="{{ p.url }}" target="_blank">
            <img src="{{ p.image }}" width="60">
        </a>
    {% else %}
        אין תמונה
    {% endif %}
</td>

<td>{{ p.title }}</td>
<td>{{ p.category }}</td>
<td>${{ p.price }}</td>
<td>${{ p.sale_price }}</td>
<td>${{ p.profit }}</td>
<td>{{ p.roi }}%</td>
<td>{{ p.orders_now }}</td>

{# ✅ זה השדה הנכון לפי ה-backend שלך #}
{% set success = p.future_success_probability | default(0) | float %}

<td class="
{% if success >= 70 %}
tag-high
{% elif success >= 40 %}
tag-mid
{% else %}
tag-low
{% endif %}
">
{{ success }}%
</td>

<td>
    {% if p.url %}
        <a href="{{ p.url }}" target="_blank">🔗 מעבר למוצר</a><br>
        <span class="small">{{ p.url }}</span>
    {% else %}
        אין קישור
    {% endif %}
</td>

</tr>
{% endfor %}
</tbody>
</table>

<br>
<a href="{{ url_for('index') }}">⬅ חזרה לדשבורד</a>

</div>
{% endblock %}
