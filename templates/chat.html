{% extends "base.html" %}
{% block title %}AI Chat{% endblock %}

{% block content %}
<div class="card chat-card">
    <h2 style="text-align:center;">ğŸ’¬ ×¦'××˜ ×¢× AI</h2>

    <div id="chat-box" class="chat-box"></div>

    <div class="chat-input-row">
        <input id="user-input" type="text" placeholder="×›×ª×•×‘ ×”×•×“×¢×”...">
        <button onclick="sendMessage()">×©×œ×—</button>
    </div>
</div>

<style>
.chat-card {
    max-width: 600px;
    margin: auto;
}

.chat-box {
    border: 1px solid #ccc;
    height: 350px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 10px;
    background: #f9f9f9;
}

.user-msg {
    background: #007bff;
    color: white;
    padding: 8px 12px;
    border-radius: 10px;
    margin: 5px 0;
    max-width: 70%;
    align-self: flex-end;
}

.ai-msg {
    background: #e5e5e5;
    color: black;
    padding: 8px 12px;
    border-radius: 10px;
    margin: 5px 0;
    max-width: 70%;
}

.chat-input-row {
    display: flex;
    gap: 10px;
}

.chat-input-row input {
    flex: 1;
    padding: 10px;
}

.chat-input-row button {
    padding: 10px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
</style>

<script>
async function sendMessage() {
    const input = document.getElementById("user-input");
    const message = input.value;

    if (!message) return;

    addMessage(message, "user");
    input.value = "";

    const response = await fetch("/api/chat", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ message })
    });

    const data = await response.json();
    addMessage(data.reply, "ai");
}

function addMessage(text, type) {
    const chatBox = document.getElementById("chat-box");
    const div = document.createElement("div");

    div.className = type === "user" ? "user-msg" : "ai-msg";
    div.innerText = text;

    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}
</script>
{% endblock %}
