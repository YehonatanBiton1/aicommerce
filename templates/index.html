<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>AICommerce â€“ ×—×™×–×•×™ ×”×¦×œ×—×ª ××•×¦×¨×™×</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f4f6f9; margin:0; padding:20px; }
        .container { max-width: 1100px; margin: auto; }
        .card {
            background:white;
            padding:20px;
            border-radius:10px;
            margin-bottom:20px;
            box-shadow:0 2px 4px rgba(0,0,0,0.05);
        }
        h1,h2,h3 { margin-top:0; }
        input, textarea { width:100%; padding:8px; margin:5px 0 10px; box-sizing:border-box; }
        button {
            padding:10px 15px;
            background:#007bff;
            border:none;
            color:white;
            cursor:pointer;
            border-radius:5px;
        }
        button:hover { background:#0056b3; }
        table { width:100%; border-collapse:collapse; font-size:14px; }
        th, td { padding:6px 4px; text-align:right; border-bottom:1px solid #eee; }
        .top-bar { display:flex; justify-content:space-between; align-items:center; }
        .small { font-size:13px; color:#555; }
        a { color:#007bff; text-decoration:none; }
        a:hover { text-decoration:underline; }
        .tag-high { background:#d4edda; color:#155724; padding:2px 6px; border-radius:4px; }
        .tag-mid  { background:#fff3cd; color:#856404; padding:2px 6px; border-radius:4px; }
        .tag-low  { background:#f8d7da; color:#721c24; padding:2px 6px; border-radius:4px; }
        .error { color:#c00; }
        .winner { background:#e3fcec; }
        .row { display:flex; flex-wrap:wrap; gap:20px; }
        .col { flex:1 1 0; min-width:260px; }
        code { background:#f1f1f1; padding:2px 4px; border-radius:3px; }
        pre { background:#f8f9fb; padding:10px; border-radius:6px; overflow-x:auto; }
        #api-key-value { direction:ltr; font-family:monospace; }
    </style>
</head>
<body>
<div class="container">

    <!-- ×›×•×ª×¨×ª + ×¡×˜×˜×•×¡ ××©×ª××© -->
    <div class="card">
        <div class="top-bar">
            <div>
                <h1>AICommerce â€“ ×—×™×–×•×™ ×”×¦×œ×—×ª ××•×¦×¨×™×</h1>
                <div class="small">
                    ××©×ª××©: {{ user.email }}<br>
                    ×× ×•×™: {{ user.plan }}
                    {% if user.plan == "FREE" %}
                        â€“ ×©×™××•×©×™× ×”×™×•×: {{ used_today }}/{{ limit_today }}
                    {% endif %}
                </div>
            </div>
            <div class="small" style="text-align:left;">
                <a href="{{ url_for('shop') }}">ğŸ›’ ×—× ×•×ª ×“××•</a><br>
                <a href="{{ url_for('logout') }}">×”×ª× ×ª×§×•×ª</a><br>
                <a href="{{ url_for('forgot_password') }}">×©×—×–×•×¨ ×¡×™×¡××”</a><br>
                {% if user.plan == "FREE" %}
                    <a href="{{ url_for('upgrade') }}">×©×“×¨×•×’ ×œ-PRO (×“××•)</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ×¡×˜×˜×•×¡ ××•×“×œ -->
    <div class="card">
        <h2>×¡×˜×˜×•×¡ ××•×“×œ AI</h2>
        {% if has_model %}
            <p>âœ… ××•×“×œ ML ×¤×¢×™×œ.</p>
            {% if model_info %}
                <p class="small">
                    RÂ²: {{ model_info.r2_test | default(0) | round(3) }} |
                    MAE: {{ model_info.mae_test | default(0) | round(2) }} |
                    ×“×’×™××•×ª ××™××•×Ÿ: {{ model_info.n_samples | default(0) }}<br>
                    ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: {{ model_info.trained_at | default("×œ× ×™×“×•×¢") }}
                </p>
            {% endif %}
        {% else %}
            <p>âš ï¸ ×›×¨×’×¢ ××™×Ÿ ××•×“×œ ML ×××•××Ÿ â€“ ×”×—×™×–×•×™ ××‘×•×¡×¡ ×¢×œ ×˜×¨× ×“ + ××—×™×¨ (MVP).</p>
        {% endif %}
        <form method="POST" action="{{ url_for('train_model_route') }}">
            <button type="submit">×××Ÿ ××•×“×œ ML ×—×™× ××™ ×¢×›×©×™×•</button>
        </form>
    </div>

    <!-- ×˜×•×¤×¡ ××•×¦×¨ ×‘×•×“×“ -->
    <div class="card">
        <h2>×—×™×–×•×™ ×œ××•×¦×¨ ×—×“×©</h2>

        {% if result and result.error %}
            <p class="error"><strong>{{ result.error }}</strong></p>
        {% endif %}

        <form method="POST" action="{{ url_for('predict') }}">
            <label>×©× ××•×¦×¨:</label>
            <input type="text" name="name" required>

            <label>×§×˜×’×•×¨×™×”:</label>
            <input type="text" name="category" required>

            <label>××—×™×¨ (â‚ª):</label>
            <input type="number" name="price" step="0.01" required>

            <label>×¦×™×•×Ÿ ×˜×¨× ×“ (0â€“100):</label>
            <input type="text" name="trend_score">

            <button type="submit">×—×©×‘ Success Score</button>
        </form>

        {% if result and not result.error %}
            <hr>
            <p><strong>Success Score:</strong> {{ result.success_score }}</p>
            <p><strong>×¨××ª ×¡×™×›×•×Ÿ:</strong> {{ result.risk }}</p>
        {% endif %}
    </div>

    <!-- Auto Pick -->
    <div class="card">
        <h2>ğŸ¤– ××¦×™××ª ××•×¦×¨×™× ×× ×¦×—×™× ××•×˜×•××˜×™×ª</h2>
        <p>×”××¢×¨×›×ª ×‘×•×—×¨×ª ×œ×‘×“ ××•×¦×¨×™× ××”×©×•×§ ×•××“×¨×’×ª ××•×ª× ×œ×¤×™ ×¤×•×˜× ×¦×™××œ ×”×¦×œ×—×” ×¢×ª×™×“×™.</p>
        <a href="{{ url_for('auto_pick') }}">
            <button>××¦× ×œ×™ ××•×¦×¨×™× ×× ×¦×—×™× ×”×©×‘×•×¢</button>
        </a>
    </div>

    <!-- ×“×©×‘×•×¨×“ -->
    {% if dashboard %}
    <div class="card">
        <h2>×ª×•×‘× ×•×ª ××”×“××˜×” ×”×›×œ×œ×™</h2>
        <p><strong>×××•×¦×¢ Success ×›×œ×œ×™:</strong> {{ dashboard.overall_mean | default(0) | round(1) }}</p>

        <h3>×××•×¦×¢ Success ×œ×¤×™ ×§×˜×’×•×¨×™×”:</h3>
        <ul>
            {% for row in dashboard.per_category %}
                <li>{{ row.category }} â€“ {{ row.mean_score | default(0) | round(1) }}</li>
            {% endfor %}
        </ul>

        <p><strong>×§×˜×’×•×¨×™×” ×—×–×§×”:</strong>
            {{ dashboard.best_category.category | default("â€”") }}
            ({{ dashboard.best_category.mean_score | default(0) | round(1) }})</p>

        <p><strong>×§×˜×’×•×¨×™×” ×—×œ×©×”:</strong>
            {{ dashboard.worst_category.category | default("â€”") }}
            ({{ dashboard.worst_category.mean_score | default(0) | round(1) }})</p>

        <h3>××•×¦×¨ ×”×›×™ ×—×–×§:</h3>
        <p>
            {{ dashboard.best_product.name }} â€“
            Success: {{ dashboard.best_product.success_score | default(0) | round(1) }}
        </p>

        <h3>××•×¦×¨ ×”×›×™ ×—×œ×©:</h3>
        <p>
            {{ dashboard.worst_product.name }} â€“
            Success: {{ dashboard.worst_product.success_score | default(0) | round(1) }}
        </p>
    </div>
    {% endif %}

</div>
</body>
</html>
